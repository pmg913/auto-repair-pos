<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto Repair POS</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    input, select, button {
      margin: 5px;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>Auto Repair POS</h1>

  <div>
    <h3>Customer Information</h3>
    <input id="custName" placeholder="Customer Name" />
    <input id="custPhone" placeholder="Phone Number" />
    <input id="custVehicle" placeholder="Vehicle (Make/Model)" />
    <input id="custMileage" placeholder="Mileage" />
    <button onclick="saveCustomerInfo()">Save Customer</button>
  </div>

  <div>
    <h3>Saved Customer History</h3>
    <pre id="historyDisplay"></pre>
  </div>

  <div>
    <h3>Add Inventory Item</h3>
    <input id="invName" placeholder="Item Name" />
    <input id="invQty" type="number" placeholder="Qty" />
    <input id="invPrice" type="number" placeholder="Unit Price" />
    <button onclick="addToInventory()">Add to Inventory</button>
  </div>

  <div>
    <h3>Select Inventory to Sell</h3>
    <select id="inventorySelect"></select>
    <input id="sellQty" type="number" placeholder="Qty" />
    <button onclick="sellFromInventory()">Add to Sale</button>
  </div>

  <div>
    <h3>Add Custom Item</h3>
    <input id="itemName" placeholder="Item/Service Name" />
    <input id="itemQty" type="number" placeholder="Qty" />
    <input id="itemPrice" type="number" placeholder="Unit Price" />
    <button onclick="addItem()">Add Item</button>
  </div>

  <div>
    <h3>Quick Services</h3>
    <select id="serviceSelect">
      <option value="Oil Change,39.99">Oil Change - $39.99</option>
      <option value="Alignment,89.99">Alignment - $89.99</option>
      <option value="Tire Rotation,29.99">Tire Rotation - $29.99</option>
    </select>
    <button onclick="addService()">Add Service</button>
  </div>

  <div>
    <h3>Labor</h3>
    <input id="laborHours" type="number" placeholder="Hours" />
    <input id="laborRate" type="number" placeholder="Hourly Rate" value="80" />
    <button onclick="addLabor()">Add Labor</button>
  </div>

  <table id="cart">
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Subtotal: $<span id="subtotal">0.00</span></h3>
  <h3>Tax (7%): $<span id="tax">0.00</span></h3>
  <h3>Total: $<span id="total">0.00</span></h3>

  <div>
    <input id="payment" type="number" placeholder="Payment Amount" />
    <button onclick="calculateChange()">Calculate Change</button>
    <h3>Change Due: $<span id="change">0.00</span></h3>
  </div>

  <button onclick="window.print()">üñ®Ô∏è Print Receipt</button>

  <script>
    let subtotal = 0;
    let inventory = [];
    let customer = {};
    let cartItems = [];
    let history = [];

    function saveCustomerInfo() {
      customer.name = document.getElementById("custName").value;
      customer.phone = document.getElementById("custPhone").value;
      customer.vehicle = document.getElementById("custVehicle").value;
      customer.mileage = document.getElementById("custMileage").value;

      const visit = {
        date: new Date().toLocaleString(),
        name: customer.name,
        phone: customer.phone,
        vehicle: customer.vehicle,
        mileage: customer.mileage,
        items: cartItems.slice(),
        subtotal: subtotal.toFixed(2),
        total: (subtotal * 1.07).toFixed(2)
      };

      history.push(visit);
      displayHistory();
      cartItems = [];
    }

    function displayHistory() {
      const historyBox = document.getElementById("historyDisplay");
      historyBox.textContent = history.map(h => `Date: ${h.date}\nCustomer: ${h.name}\nPhone: ${h.phone}\nVehicle: ${h.vehicle}\nMileage: ${h.mileage}\nItems: ${h.items.map(i => `${i.name} x${i.qty} @ $${i.price.toFixed(2)}`).join(", ")}\nTotal: $${h.total}\n---\n`).join("\n");
    }

    function updateInventoryDropdown() {
      const select = document.getElementById("inventorySelect");
      select.innerHTML = "";
      inventory.forEach((item, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = `${item.name} ($${item.price.toFixed(2)} | ${item.qty} in stock)`;
        select.appendChild(option);
      });
    }

    function addToInventory() {
      const name = document.getElementById("invName").value;
      const qty = parseInt(document.getElementById("invQty").value);
      const price = parseFloat(document.getElementById("invPrice").value);
      if (name && qty > 0 && price >= 0) {
        inventory.push({ name, qty, price });
        updateInventoryDropdown();
      }
    }

    function sellFromInventory() {
      const index = parseInt(document.getElementById("inventorySelect").value);
      const sellQty = parseInt(document.getElementById("sellQty").value);
      if (inventory[index] && sellQty > 0 && sellQty <= inventory[index].qty) {
        const item = inventory[index];
        item.qty -= sellQty;
        addRow(item.name, sellQty, item.price);
        updateInventoryDropdown();
      }
    }

    function addRow(name, qty, price) {
      const table = document.querySelector("#cart tbody");
      const row = document.createElement("tr");
      const total = qty * price;
      subtotal += total;
      cartItems.push({ name, qty, price });
      row.innerHTML = `<td>${name}</td><td>${qty}</td><td>$${price.toFixed(2)}</td><td>$${total.toFixed(2)}</td>`;
      table.appendChild(row);
      updateTotals();
    }

    function addItem() {
      const name = document.getElementById("itemName").value;
      const qty = parseFloat(document.getElementById("itemQty").value);
      const price = parseFloat(document.getElementById("itemPrice").value);
      if (name && qty > 0 && price >= 0) {
        addRow(name, qty, price);
      }
    }

    function addService() {
      const selected = document.getElementById("serviceSelect").value.split(",");
      const name = selected[0];
      const price = parseFloat(selected[1]);
      addRow(name, 1, price);
    }

    function addLabor() {
      const hours = parseFloat(document.getElementById("laborHours").value);
      const rate = parseFloat(document.getElementById("laborRate").value);
      if (hours > 0 && rate >= 0) {
        addRow("Labor", hours, rate);
      }
    }

    function updateTotals() {
      const tax = subtotal * 0.07;
      const total = subtotal + tax;
      document.getElementById("subtotal").textContent = subtotal.toFixed(2);
      document.getElementById("tax").textContent = tax.toFixed(2);
      document.getElementById("total").textContent = total.toFixed(2);
    }

    function calculateChange() {
      const payment = parseFloat(document.getElementById("payment").value);
      const total = subtotal + subtotal * 0.07;
      const change = payment - total;
      document.getElementById("change").textContent = change >= 0 ? change.toFixed(2) : "0.00";
    }
  </script>
</body>
</html>
